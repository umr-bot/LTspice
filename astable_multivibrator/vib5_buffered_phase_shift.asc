Version 4
SHEET 1 3012 836
WIRE 2464 -416 2336 -416
WIRE 1456 -368 1456 -384
WIRE 2336 -352 2336 -416
WIRE 2368 -352 2336 -352
WIRE 2464 -336 2464 -416
WIRE 2464 -336 2432 -336
WIRE 2256 -320 2256 -368
WIRE 2368 -320 2256 -320
WIRE 992 -272 944 -272
WIRE 2144 -272 2064 -272
WIRE 2176 -272 2144 -272
WIRE 1456 -256 1456 -288
WIRE 1584 -256 1568 -256
WIRE 944 -240 944 -272
WIRE 1152 -208 1136 -208
WIRE 1184 -208 1152 -208
WIRE 1568 -208 1568 -256
WIRE 2064 -208 2064 -272
WIRE 2464 -208 2464 -336
WIRE 2464 -208 2432 -208
WIRE 1184 -192 1184 -208
WIRE 720 -176 -432 -176
WIRE -432 -160 -432 -176
WIRE 1152 -160 1152 -208
WIRE 1152 -160 1056 -160
WIRE 1504 -160 1456 -160
WIRE 928 -112 736 -112
WIRE 2432 -112 2432 -208
WIRE 2064 -96 2064 -128
WIRE 2176 -80 2176 -272
WIRE 1184 -64 1184 -112
WIRE 1248 -64 1184 -64
WIRE 176 -48 -16 -48
WIRE 1184 -48 1184 -64
WIRE 1568 -48 1568 -112
WIRE -432 -32 -432 -80
WIRE -368 -32 -432 -32
WIRE -240 -32 -288 -32
WIRE 528 -32 336 -32
WIRE 736 -32 736 -112
WIRE 784 -32 736 -32
WIRE 928 -16 928 -112
WIRE 928 -16 848 -16
WIRE 960 -16 928 -16
WIRE 1056 -16 1056 -80
WIRE 1056 -16 1024 -16
WIRE 1856 -16 1728 -16
WIRE 2016 -16 1856 -16
WIRE 2688 -16 2672 -16
WIRE 720 0 720 -176
WIRE 784 0 720 0
WIRE 1056 0 1056 -16
WIRE 1120 0 1056 0
WIRE 1248 0 1248 -64
WIRE 1296 0 1248 0
WIRE 1424 0 1360 0
WIRE 1856 0 1856 -16
WIRE 2112 0 2064 0
WIRE 2176 0 2176 -16
WIRE 2176 0 2112 0
WIRE 2432 0 2432 -32
WIRE 2432 0 2368 0
WIRE 2528 0 2432 0
WIRE 1424 16 1424 0
WIRE -16 32 -16 -48
WIRE 32 32 -16 32
WIRE 1056 32 1056 0
WIRE 2112 32 2112 0
WIRE 2432 32 2432 0
WIRE 2672 32 2672 -16
WIRE 2672 32 2592 32
WIRE -432 48 -432 -32
WIRE -384 48 -432 48
WIRE 176 48 176 -48
WIRE 176 48 96 48
WIRE 336 48 336 -32
WIRE 384 48 336 48
WIRE -240 64 -240 -32
WIRE -240 64 -320 64
WIRE -176 64 -240 64
WIRE -64 64 -96 64
WIRE 528 64 528 -32
WIRE 528 64 448 64
WIRE 576 64 528 64
WIRE 720 64 720 0
WIRE 720 64 656 64
WIRE 752 64 720 64
WIRE 800 64 752 64
WIRE 1184 64 1184 48
WIRE -384 80 -416 80
WIRE 208 80 176 80
WIRE 320 80 288 80
WIRE 384 80 320 80
WIRE 992 96 800 96
WIRE -64 112 -64 64
WIRE 176 112 176 80
WIRE 176 112 -64 112
WIRE 1424 112 1424 96
WIRE -64 128 -64 112
WIRE 720 128 720 64
WIRE -416 144 -416 80
WIRE 320 144 320 80
WIRE 1056 144 1056 112
WIRE 1184 144 1056 144
WIRE 1856 144 1856 80
WIRE 1856 144 1808 144
WIRE 1184 160 1184 144
WIRE 2432 160 2432 112
WIRE 2432 160 2304 160
WIRE 2592 160 2592 112
WIRE 2736 160 2736 112
WIRE 2736 160 2592 160
WIRE 800 176 800 96
WIRE 848 176 800 176
WIRE 1808 176 1808 144
WIRE 2128 176 2080 176
WIRE 2176 176 2176 160
WIRE 2176 176 2128 176
WIRE 992 192 992 96
WIRE 992 192 912 192
WIRE 2592 192 2592 160
WIRE -416 208 -416 144
WIRE 1568 208 1568 32
WIRE 1760 208 1568 208
WIRE 1856 208 1856 144
WIRE 2304 224 2304 160
WIRE 2336 224 2304 224
WIRE 2432 240 2432 160
WIRE 2432 240 2400 240
WIRE -64 256 -64 192
WIRE 224 256 -64 256
WIRE 320 256 320 208
WIRE 320 256 224 256
WIRE 720 256 720 192
WIRE 720 256 320 256
WIRE 2224 256 2224 208
WIRE 2336 256 2224 256
WIRE 2176 272 2176 176
WIRE 224 288 224 256
WIRE 1184 304 1168 304
WIRE 1216 304 1184 304
WIRE 1584 304 1568 304
WIRE 752 320 752 64
WIRE 752 320 688 320
WIRE 928 320 912 320
WIRE 1216 320 1216 304
WIRE 832 336 832 320
WIRE 832 336 768 336
WIRE 1568 336 1568 304
WIRE 1760 336 1760 208
WIRE 1856 336 1856 288
WIRE 1856 336 1760 336
WIRE 2032 336 1856 336
WIRE 1184 352 1184 304
WIRE 1184 352 1088 352
WIRE 2128 352 2080 352
WIRE 2176 352 2176 336
WIRE 2176 352 2128 352
WIRE 1504 384 1488 384
WIRE 688 400 688 320
WIRE 768 400 768 336
WIRE 784 400 768 400
WIRE 928 416 928 320
WIRE 928 416 848 416
WIRE 2128 416 2128 352
WIRE 784 432 752 432
WIRE 1488 432 1488 384
WIRE 1568 448 1568 432
WIRE 1600 448 1568 448
WIRE 1728 448 1728 -16
WIRE 1728 448 1680 448
WIRE 1216 464 1216 400
WIRE 752 480 752 432
WIRE 928 496 928 416
WIRE 992 496 928 496
WIRE 1008 496 992 496
WIRE 1088 496 1088 432
WIRE 1088 496 1056 496
WIRE 1088 512 1088 496
WIRE 1152 512 1088 512
WIRE 2128 528 2128 496
WIRE 1088 544 1088 512
WIRE 1280 560 1216 560
WIRE 1360 560 1280 560
WIRE 1520 560 1424 560
WIRE 1216 576 1216 560
WIRE 1520 576 1520 560
WIRE 1088 656 1088 624
WIRE 1216 656 1088 656
WIRE 1216 672 1216 656
FLAG 416 32 V+
FLAG 416 96 v-
FLAG -336 496 0
FLAG -224 432 v-
FLAG -224 512 0
FLAG -336 416 V+
FLAG 64 16 V+
FLAG 64 80 v-
FLAG -352 32 V+
FLAG -352 96 v-
FLAG 800 64 vout
IOPIN 800 64 Out
FLAG 224 288 0
FLAG -416 288 0
FLAG 944 -160 0
FLAG 992 -272 vcc
FLAG 1136 -208 vcc
FLAG 1184 160 0
FLAG 816 -48 V+
FLAG 816 16 v-
FLAG 1248 -64 v_collector
FLAG 1424 112 0
FLAG 2592 192 0
FLAG 1168 304 vcc
FLAG 1216 672 0
FLAG 816 384 V+
FLAG 816 448 v-
FLAG -416 144 vref
FLAG 752 480 vref
FLAG 1280 560 v_collector2
FLAG 1520 656 0
FLAG 880 160 V+
FLAG 880 224 v-
FLAG 1456 -256 0
FLAG 1456 -384 vbat
FLAG 1568 -256 vbat
FLAG 1568 304 vbat
FLAG 1808 176 0
FLAG 2144 -272 vref
FLAG 2128 176 vref
FLAG 2128 528 0
FLAG 2112 112 0
FLAG 1424 0 va1
FLAG 1520 560 va2
FLAG 2368 0 0
FLAG 2256 -368 va1
FLAG 2656 -304 0
FLAG 2736 -304 0
FLAG 2656 -384 v25
FLAG 2400 -368 v25
FLAG 2736 -384 -v25
FLAG 2400 -304 -v25
FLAG 2224 208 va2
FLAG 2368 208 v25
FLAG 2368 272 -v25
FLAG 2672 -16 vtransformer
SYMBOL OpAmps\\opamp2 416 0 R0
SYMATTR InstName U1
SYMATTR Value TL081
SYMBOL res 304 64 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R1
SYMATTR Value 100k
SYMBOL cap 304 144 R0
SYMATTR InstName C3
SYMATTR Value 100n
SYMBOL voltage -336 400 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value 12
SYMBOL voltage -224 416 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V2
SYMATTR Value 0
SYMBOL OpAmps\\opamp2 64 -16 R0
SYMATTR InstName U2
SYMATTR Value TL081
SYMBOL cap -80 128 R0
SYMATTR InstName C1
SYMATTR Value 100n
SYMBOL res -80 48 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R2
SYMATTR Value 100k
SYMBOL res 672 48 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R3
SYMATTR Value 33k
SYMBOL OpAmps\\opamp2 -352 0 R0
SYMATTR InstName U3
SYMATTR Value TL081
SYMBOL res -272 -48 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R4
SYMATTR Value 10.3Meg
SYMBOL res -448 -64 M180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R5
SYMATTR Value 10k
SYMBOL cap 704 128 R0
SYMATTR InstName C2
SYMATTR Value 100n
SYMBOL voltage -416 192 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V3
SYMATTR Value 6
SYMBOL npn 1120 -48 R0
SYMATTR InstName Q1
SYMATTR Value 2N2222
SYMBOL voltage 944 -256 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V4
SYMATTR Value 12
SYMBOL res 1168 48 R0
SYMATTR InstName R6
SYMATTR Value 4800
SYMBOL res 1168 -208 R0
SYMATTR InstName R7
SYMATTR Value 80k
SYMBOL res 1040 -176 R0
SYMATTR InstName R8
SYMATTR Value 120k
SYMBOL res 1040 16 R0
SYMATTR InstName R9
SYMATTR Value 10k
SYMBOL OpAmps\\opamp2 816 -80 R0
SYMATTR InstName U4
SYMATTR Value TL081
SYMBOL cap 1024 -32 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C5
SYMATTR Value 220µ
SYMBOL res 1408 0 R0
SYMATTR InstName R10
SYMATTR Value 560k
SYMBOL ind2 2416 16 R0
SYMATTR InstName Lp2
SYMATTR Value 0.3
SYMATTR Type ind
SYMATTR SpiceLine Rser=0.0001
SYMBOL ind2 2608 128 R180
WINDOW 0 36 80 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName Ls1
SYMATTR Value 5300
SYMATTR Type ind
SYMBOL res 2720 16 R0
SYMATTR InstName R11
SYMATTR Value 1k
SYMBOL cap 1360 -16 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C6
SYMATTR Value 220µ
SYMBOL res 1472 -176 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R13
SYMATTR Value 100k
SYMBOL res 1200 560 R0
SYMATTR InstName R12
SYMATTR Value 100k
SYMBOL res 1200 304 R0
SYMATTR InstName R14
SYMATTR Value 4800
SYMBOL res 1072 336 R0
SYMATTR InstName R15
SYMATTR Value 10k
SYMBOL res 1072 528 R0
SYMATTR InstName R16
SYMATTR Value 120k
SYMBOL cap 1056 480 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C4
SYMATTR Value 220µ
SYMBOL pnp 1152 464 R0
SYMATTR InstName Q3
SYMATTR Value 2N3906
SYMBOL OpAmps\\opamp2 816 352 R0
SYMATTR InstName U5
SYMATTR Value TL081
SYMBOL res 784 384 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R17
SYMATTR Value 100k
SYMBOL res 928 304 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R18
SYMATTR Value 100k
SYMBOL cap 1424 544 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C7
SYMATTR Value 220µ
SYMBOL res 1504 560 R0
SYMATTR InstName R19
SYMATTR Value 560k
SYMBOL ind2 2416 -128 R0
SYMATTR InstName Lp1
SYMATTR Value 0.3
SYMATTR Type ind
SYMBOL pnp 1504 432 M180
SYMATTR InstName Q4
SYMATTR Value tip42c
SYMBOL res 1472 416 R0
SYMATTR InstName R21
SYMATTR Value 100k
SYMBOL voltage 1456 -384 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V7
SYMATTR Value 12
SYMBOL OpAmps\\opamp2 880 128 R0
SYMATTR InstName U6
SYMATTR Value TL081
SYMBOL res 1696 432 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R20
SYMATTR Value 1k
SYMBOL res 1552 -64 R0
SYMATTR InstName R22
SYMATTR Value 1k
SYMBOL res 1840 -16 R0
SYMATTR InstName R23
SYMATTR Value 10k
SYMBOL nmos 2016 -96 R0
SYMATTR InstName M1
SYMATTR Value IRFH5306
SYMBOL nmos 2032 256 R0
SYMATTR InstName M2
SYMATTR Value IRFH5306
SYMBOL diode 2192 -16 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D1
SYMATTR Value 1N4148
SYMBOL diode 2192 336 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D2
SYMATTR Value 1N4148
SYMBOL res 1840 192 R0
SYMATTR InstName R24
SYMATTR Value 10k
SYMBOL npn 1664 -224 R0
SYMATTR InstName Q5
SYMATTR Value tip41c
SYMBOL pnp 1504 -112 M180
SYMATTR InstName Q2
SYMATTR Value tip42c
SYMBOL res 2064 160 R0
SYMATTR InstName R25
SYMATTR Value 100
SYMBOL res 2112 400 R0
SYMATTR InstName R26
SYMATTR Value 100
SYMBOL res 2048 -224 R0
SYMATTR InstName R27
SYMATTR Value 100
SYMBOL res 2096 16 R0
SYMATTR InstName R28
SYMATTR Value 100
SYMBOL voltage 2656 -400 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V6
SYMATTR Value 25
SYMBOL voltage 2736 -400 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V8
SYMATTR Value -25
SYMBOL OpAmps\\opamp2 2400 -400 R0
SYMATTR InstName U7
SYMATTR Value TL081
SYMBOL OpAmps\\opamp2 2368 176 R0
SYMATTR InstName U8
SYMATTR Value TL081
TEXT -112 368 Left 2 !.tran 0 500m 0 10u\n.include tip41c.lib
TEXT -112 424 Left 2 !.include TL081.sub
TEXT 2664 456 Left 2 !K Lp1 Lp2 Ls1 1
TEXT 1664 568 Left 2 !.include tip41c.lib
TEXT 1664 592 Left 2 !.include tip42c.lib
TEXT 2560 -192 Left 2 ;when va2 is high, vtransformer is high,\nwhen va1 is low, vtransformer is low
